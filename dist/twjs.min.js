!function(e){e.module("twjs",["ngSanitize","ngAnimate","pascalprecht.translate","ui.bootstrap","toaster"])}(angular),angular.module("twjs").config(["$translateProvider",function(e){e.translations("pt",{post:{title:"Alteração de informações",message:"Atualização realizada com sucesso!"},put:{title:"Inclusão de informações",message:"Cadastro realizado com sucesso!"},status:{title:"Alteração de status",message:"Atualização de status realizado com sucesso!"},del:{title:"Exclusão de informações",message:"Exclusão realizada com sucesso!"},errorQuery:{title:"Resultado da Pesquisa:",message:"Nenhum registro encontrado!"}}),e.preferredLanguage("pt")}]),function(){"use strict";angular.module("twjs").factory("twAlert",["$translate","$uibModal","toaster",function(e,t,n){function r(e){n.pop(e.type,e.title,e.message)}var o={INFO:"info",ERRO:"error",ALERTA:"warning",SUCESSO:"success",AGUARDE:"wait"},s={messages:{post:{title:"post.title",message:"post.message",type:o.SUCESSO},put:{title:"put.title",message:"put.message",type:o.SUCESSO},status:{title:"status.title",message:"status.message",type:o.SUCESSO},del:{title:"del.title",message:"del.message",type:o.SUCESSO},errorQuery:{title:"errorQuery.title",message:"errorQuery.message",type:o.INFO}}};return{confirm:function(e,n){return t.open({animation:!1,templateUrl:"view/common/confirm.html",controller:["$uibModalInstance","itm",function(e,t){var n=this;n.itm=t,n.no=function(){e.dismiss("cancel")},n.yes=function(){e.close(n.item)}}],controllerAs:"vm",size:"sm",resolve:{itm:function(){return{titulo:e,message:n}}}}).result},showToast:r,showError:function(e,t){r({title:e,message:t,type:o.ERRO})},showInfo:function(e,t){r({title:e,message:t,type:o.INFO})},showWarning:function(e,t){r({title:e,message:t,type:o.ALERTA})},showSuccess:function(e,t){r({title:e,message:t,type:o.SUCESSO})},utils:s,alertType:o,getMessagesTranslations:function(){var t=Object.keys(s.messages);angular.forEach(t,function(t,n){angular.forEach(Object.keys(s.messages[t]),function(n){"type"!==n&&e(s.messages[t][n]).then(function(e){s.messages[t][n]=e})})})}}}]).run(["twAlert",function(e){e.getMessagesTranslations()}])}(),function(){"use strict";angular.module("twjs").factory("BearerAuthInterceptor",["$q","$rootScope","twAuthStorage",function(e,t,n){var r=n.getUserStore();return t.$on("app.logon",function(e,t){r=t}),t.$on("app.logoff",function(e,t){r=null}),{request:function(t){return t.headers=t.headers||{},r&&r.access_token&&(t.headers.Authorization="Bearer "+r.access_token),n.updateLastRequest(),e.when(t)}}}]).config(["$httpProvider",function(e){e.interceptors.push("BearerAuthInterceptor")}])}(),function(){"use strict";angular.module("twjs").factory("twAuthStorage",["twConfig","$window",function(e,t){function n(){o=1!==e.authStorageType&&e.authStorageType?t.localStorage:t.sessionStorage}var r=null,o=1!==e.authStorageType&&e.authStorageType?t.localStorage:t.sessionStorage;return{getUserStore:function(){n();angular.injector(["ng"]).get("$window");var t=o.getItem(e.storageAuthName);return""!=t&&null!=t?angular.fromJson(t):null},setUserStore:function(t){n();angular.injector(["ng"]).get("$window");return o.setItem(e.storageAuthName,angular.toJson(t))},clearUserStore:function(){n();angular.injector(["ng"]).get("$window");o.removeItem(e.storageAuthName)},getLastRequest:function(){return r},updateLastRequest:function(){r=new Date}}}])}(),function(){"use strict";angular.module("twjs").provider("twConfig",[function(){var e={};this.logDebugLevel=function(t){e.logDebugLevel=t},this.serviceUrl=function(t){e.serviceUrl=t},this.storageAuthName=function(t){e.storageAuthName=t},this.authEndpoint=function(t){e.authEndpoint=t},this.onRefreshTokenError=function(t){e.onRefreshTokenError=t},this.suppressErrors=function(t){e.suppressErrors=t},this.authStorageType=function(t){e.authStorageType=t},this.appKey=function(t){e.appKey=t},this.appId=function(t){e.appId=t},this.$get=[function(){return e}]}])}(),function(){"use strict";angular.module("twjs").factory("twController",["$rootScope","$state","$stateParams","twAlert",function(e,t,n,r){return{master:function(n,r,o){var s={},a=e.$on("queried",function(e,t){s.items=t});o.$on("$destroy",a);var i=e.$on("canceled",function(){if(s.items&&s.items.length>0){for(var e=0;e<s.items.length;e++)s.items[e].updated=!1;t.go("^.grid",{items:s.items})}else t.go("^.grid")});o.$on("$destroy",i);var u=e.$on("saved",function(e,n){if(s.items&&s.items.length>0){var o=s.items.filter(function(e){e.updated=!1;for(var t in n)if(e[t]!=n[t])return!1;return!0});r.getOne(n).then(function(e){var n=o.length>0?s.items.indexOf(o[0]):-1;e[0].updated=!0,-1==n?s.items.splice(0,0,e[0]):s.items.splice(n,1,e[0]),t.go("^.grid",{items:s.items})})}else r.getOne(n).then(function(e){t.go("^.grid",{items:e})})});return o.$on("$destroy",u),n.__proto__=s,n},grid:function(o,s){var a={};a.Filter={},a.debounce=0,a.searching=!1,a.complete=!1,a.items=[];return a.search=function(t){a.searching||(a.searching=!0,t||(a.page=0,a.complete=!1,a.items=[]),s.getAll({Config:{Skip:a.page,Top:20},Filter:a.Filter}).then(function(t){e.$emit("queried",t),a.items=a.items.concat(t),t.length<20&&(a.complete=!0),t.length>0&&(a.page+=1),o.loaded&&o.loaded()}).finally(function(){a.searching=!1}))},a.add=function(){t.go("^.form")},a.edit=function(e){t.go("^.form",e)},a.toggle=function(e){s.toggle(e).then(function(t){e.Status=t})},a.del=function(e){r.confirm("Exclusão de registro","Deseja excluir esse registro?").then(function(){s.del(e).then(function(t){a.items.splice(a.items.indexOf(e),1),r.showSuccess("Exclusão de registro.","Esse registro foi excluído com sucesso!")})})},n.items&&(a.items=angular.fromJson(angular.toJson(n.items))),n.filter&&(a.Filter=angular.fromJson(n.filter),a.search()),o.__proto__=a,o},form:function(o,s){var a={},i=angular.fromJson(n),u=!1;if(null!=i)for(var c in i)if(""!=i[c]&&null!=i[c]){u=!0;break}return u?(a.action="EDIÇÃO",a.loading=!0,s.get(i).then(function(e){a.item=e,o.loaded&&o.loaded()},function(e){a.cancel()}).finally(function(){a.loading=!1})):(a.action="INCLUSÃO",a.item={}),a.cancel=function(){e.$emit("canceled"),t.go("^.grid")},a.save=function(){a.loading=!0,u?s.put(a.item).then(function(n){r.showSuccess("Atualização de registro","Operação realizada com sucesso!"),e.$emit("saved",i),t.go("^.grid")}).finally(function(){a.loading=!1}):s.post(a.item).then(function(n){r.showSuccess("Inclusão de registro","Operação realizada com sucesso!"),e.$emit("saved",n),t.go("^.grid")}).finally(function(){a.loading=!1})},o.__proto__=a,o},instantiate:function(e){var t={};return e.__proto__=t,e}}}])}(),function(){"use strict";angular.module("twjs").factory("twLog",["$log","twConfig",function(e,t){var n={ERROR:1,WARNING:2,DEBUG:4,INFO:8,LOG:16};return{log:function(r,o){o===n.ERROR&&t.logDebugLevel&n.ERROR>0&&e.error(r),o===n.WARNING&&t.logDebugLevel&n.WARNING>0&&e.warn(r),o===n.DEBUG&&t.logDebugLevel&n.DEBUG>0&&e.debug(r),o===n.INFO&&t.logDebugLevel&n.INFO>0&&e.info(r),o===n.LOG&&t.logDebugLevel&n.LOG>0&&e.log(r)},logLevel:n}}])}(),function(){"use strict";angular.module("twjs").factory("twService",["$rootScope","$state","$q","$http","$httpParamSerializerJQLike","$timeout","$uibModal","twLog","twAlert","twConfig","twAuthStorage",function(e,t,n,r,o,s,a,i,u,c,l){function g(t){function s(){l.clearUserStore(),e.$broadcast("app.logoff")}function a(){return null==(i=l.getUserStore())||null==i.access_token?null:i}var i=null,u=function(t){l.clearUserStore(),e.$broadcast("app.logoff");var s={grant_type:"refresh_token"},a=_.merge(s,t);return r({method:"POST",url:c.authEndpoint,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:o(a)}).then(function(t){if(200==t.status)return i=t.data,l.setUserStore(i),e.$broadcast("app.logon",i),i}).catch(function(e){return n.reject("Falha na autenticação automática")})},g={refreshToken:function(e){var t=l.getUserStore();return t?(e||(e=t),u(e).catch(function(e){return n.reject(e)})):n.reject("Não autenticado")},login:function(t){var o="grant_type=password&username="+encodeURIComponent(t.username)+"&password="+encodeURIComponent(t.password),a={headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(c.appId+":"+c.appKey),KeepConnected:!1},xhrFields:{withCredentials:!0}};return t.keepConnected&&(a.headers.KeepConnected=!0),r.post(c.authEndpoint,o,a).then(function(t){return i=t.data,l.setUserStore(i),e.$broadcast("app.logon",i),i},function(e){return s(),n.reject(e)})},logout:s,restore:a,checkProfile:function(e){return null!=i&&e.indexOf(i.profile)>=0},isAuthenticated:function(){return null!==a()}};return _.extend(t,f(g,""))}var f=function(e,t){function o(e){return e.data}var s={request:function(s,a,l){return l=l||{},l.supressError=l.supressError||!1,l.headers||(l.headers={}),l.headers.timestamp=(new Date).toISOString(),l.supressError?r.post(c.serviceUrl+t+s,a,l).then(o):r.post(c.serviceUrl+t+s,a,l).then(o,function(t){var r="";switch(t.status){case-1:r="Falha ao acessar o servidor. Verifique sua internet.";break;case 401:r="Serviço não autorizado. Verifique se você tem permissão para acessar esse recurso.";break;case 404:r="Serviço não localizado. Talvez ele esteja apenas indisponível.";break;default:r="Falha na chamada do serviço."}if(401!=t.status)return i.log(t.config.method+": "+t.config.url,i.logLevel.INFO),t.data&&"Barn.Util.BarnWarning"===t.data.ExceptionType?(r=t.data&&t.data.ExceptionMessage?t.data.ExceptionMessage:r,u.showWarning("Alerta sobre a operação",r)):c.suppressErrors||u.showError("Erro no servidor",r),n.reject(t);g(e).refreshToken().then(function(){return this.req(s,a,l)}).catch(c.onRefreshTokenError)})}};return _.extend(e,s)};return{basic:f,crud:function(e,t){var r=[],o={get:function(e){return this.request("get",e)},getOne:function(e){return this.request("getone",e)},getAll:function(e){return this.request("getall",e)},put:function(e){return this.request("put",e)},post:function(e){return this.request("post",e)},del:function(e){return this.request("del",e)},toggle:function(e){return this.request("toggle",e)},list:function(e){return this.request("list",e)},listCached:function(t){return n(function(n,o){s(function(){n(0===r.length?e.list({}).then(function(e){return r=e,t?r.filter(t):r}):t?r.filter(t):r)},0,!0)})}};return angular.extend(e,f(o,t))},oAuth:g}}])}();